<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Emoji Newsroom</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/confetti-js@0.0.18/dist/index.min.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
    body {
      font-family: 'Inter', sans-serif;
    }
    /* Styles for the new confetti canvas to ensure it's on top and doesn't interfere with the main content */
    #confetti-canvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 10;
      pointer-events: none; /* Allows clicks to pass through to the elements below */
    }
  </style>
</head>
<body class="bg-gradient-to-br from-gray-100 to-gray-200 p-4 min-h-screen flex items-center justify-center">

  <div id="root"></div>
  <canvas id="confetti-canvas"></canvas> <!-- This is the new canvas element for the confetti effect -->

  <script type="text/babel">
    const { useState, useEffect } = React;
    const { createRoot } = ReactDOM;

    const gameData = [
      {
        headline: 'Global economic summit concludes with new trade agreements to combat inflation.',
        correctTranslation: '🤝💰📈🌐',
        emojiPalette: ['🤝', '💰', '📈', '🌐', '📉', '💸', '💼', '🏙️', '📰'],
        explanation: 'The translation uses a handshake (🤝) for the agreements, money (💰) for the economy, a chart (📈) for inflation, and a globe (🌐) for the global summit.'
      },
      {
        headline: 'International space agency successfully launches a new telescope into orbit.',
        correctTranslation: '🚀🔭✨🌌',
        emojiPalette: ['🚀', '🔭', '✨', '🌌', '🌍', '🛰️', '🌠', '☄️', '👨‍🚀'],
        explanation: 'This highlights the rocket launch (🚀), the new telescope (🔭), the sparkles (✨) for the breakthrough, and the galaxy (🌌) for space.'
      },
      {
        headline: 'Widespread wildfires in the northern hemisphere prompt large-scale evacuations.',
        correctTranslation: '🔥🌲🌪️�🏃',
        emojiPalette: ['🔥', '🌲', '🌪️', '🏠', '🏃', '🌬️', '🚨', '😭', '🗺️'],
        explanation: 'The translation uses fire (🔥) for wildfires, a pine tree (🌲) for the forest, a tornado (🌪️) for the winds/spread, a house (🏠) for evacuations, and a person running (🏃) to show the urgency.'
      },
      {
        headline: 'New study links rising ocean temperatures to increased marine life migration.',
        correctTranslation: '🌊🔥🐟🚶',
        emojiPalette: ['🌊', '🔥', '🐟', '🚶', '🌡️', '🐠', '🦈', '🗺️', '🧊'],
        explanation: 'This uses a wave (🌊) and fire (🔥) to represent the hot ocean, a fish (🐟) for marine life, and a walking person (🚶) for migration.'
      },
      {
        headline: 'A breakthrough in solar panel technology promises cheaper, more efficient energy.',
        correctTranslation: '☀️🔋💡💰',
        emojiPalette: ['☀️', '🔋', '💡', '💰', '♻️', '🔌', '⚡️', '🏠', '📈'],
        explanation: 'This uses the sun (☀️) for solar, a battery (🔋) for energy, a lightbulb (💡) for the breakthrough, and money (💰) for the cheaper cost.'
      },
      {
        headline: 'Global conservation efforts lead to a significant increase in endangered species populations.',
        correctTranslation: '🌱🤝🐘📈',
        emojiPalette: ['🌱', '🤝', '🐘', '📈', '🌿', '🦁', '🦒', '🌲', '♻️'],
        explanation: 'This uses a seedling (🌱) to represent growth and conservation, a handshake (🤝) for the global efforts, an elephant (🐘) as a species example, and a chart (📈) for the population increase.'
      }
    ];

    // New game stages to control flow
    const GAME_STAGES = {
      SPLASH: 'splash',
      RULES: 'rules',
      GAME: 'game'
    };

    // Splash screen component
    const SplashScreen = () => (
      <div className="flex items-center justify-center min-h-screen bg-gradient-to-br from-blue-500 to-indigo-600 text-white animate-fade-in">
        <div className="text-center transform transition-all duration-1000 animate-bounce-slow">
          <h1 className="text-6xl font-extrabold mb-4 drop-shadow-md">📰</h1>
          <h2 className="text-4xl font-extrabold tracking-wide text-white">Emoji Newsroom</h2>
        </div>
      </div>
    );

    // Rules screen component
    const RulesScreen = ({ onStartGame }) => (
      <div className="bg-white rounded-3xl shadow-xl p-6 md:p-10 max-w-lg w-full flex flex-col space-y-6 animate-fade-in">
        <h1 className="text-3xl font-extrabold text-gray-900 text-center">How to Play</h1>
        <div className="text-lg text-gray-700 space-y-4">
          <p>Your mission is to translate a news headline into a series of emojis using the palette provided.</p>
          <ul className="list-disc list-inside space-y-2">
            <li>Select the emojis you think best represent the headline.</li>
            <li>Press "Submit" to see your score.</li>
            <li>The closer your translation is to the correct one, the higher your score!</li>
            <li>Press "Next Round" to continue playing.</li>
            <li>Use the "RANDOM" button to get a new headline without changing the round.</li>
          </ul>
        </div>
        <button
          onClick={onStartGame}
          className="w-full bg-blue-500 text-white font-bold py-4 px-6 rounded-2xl text-xl mt-6 transition-all duration-300 hover:bg-blue-600 transform hover:scale-105 active:scale-95 shadow-lg"
        >
          START!
        </button>
      </div>
    );

    const App = () => {
      const [headlineIndex, setHeadlineIndex] = useState(0);
      const [userTranslation, setUserTranslation] = useState('');
      const [score, setScore] = useState(null);
      const [message, setMessage] = useState('');
      const [showResult, setShowResult] = useState(false);
      const [round, setRound] = useState(1);
      const [isAnimating, setIsAnimating] = useState(false);
      const [gameStage, setGameStage] = useState(GAME_STAGES.SPLASH);

      // Effect to handle splash screen transition
      useEffect(() => {
        if (gameStage === GAME_STAGES.SPLASH) {
          const timer = setTimeout(() => {
            setGameStage(GAME_STAGES.RULES);
          }, 3000);
          return () => clearTimeout(timer);
        }
      }, [gameStage]);

      // Effect to handle confetti for high scores
      useEffect(() => {
        if (showResult && score >= 8) {
          // This has been updated to target the new confetti canvas
          const confettiSettings = { target: 'confetti-canvas', size: 1.5, rotate: true };
          const confetti = new ConfettiGenerator(confettiSettings);
          confetti.render();

          // Stop confetti after a few seconds
          setTimeout(() => {
            confetti.clear();
          }, 4000);
        }
      }, [showResult, score]);

      const { headline, correctTranslation, emojiPalette, explanation } = gameData[headlineIndex];

      const handleEmojiClick = (emoji) => {
        if (!showResult) {
          setUserTranslation(prev => prev + emoji);
        }
      };

      const handleClear = () => {
        if (!showResult) {
          setUserTranslation('');
        }
      };

      const handleSubmit = () => {
        if (userTranslation.trim() === '') {
          setMessage('Please enter your translation first.');
          return;
        }
        
        setIsAnimating(true);

        let currentScore = 0;
        if (userTranslation === correctTranslation) {
          currentScore = 10;
          setMessage('Perfect! 10/10!');
        } else {
          const correctSet = new Set(correctTranslation.split(''));
          const userSet = new Set(userTranslation.split(''));
          let matchedCount = 0;
          for (const emoji of userSet) {
            if (correctSet.has(emoji)) {
              matchedCount++;
            }
          }
          currentScore = Math.round((matchedCount / correctSet.size) * 10);
          currentScore = Math.min(currentScore, 10);
          setMessage(`Almost! Score: ${currentScore}/10.`);
        }

        setTimeout(() => {
          setScore(currentScore);
          setShowResult(true);
          setIsAnimating(false);
        }, 500);
      };

      const handleNextRound = () => {
        const nextIndex = (headlineIndex + 1) % gameData.length;
        setHeadlineIndex(nextIndex);
        setUserTranslation('');
        setScore(null);
        setMessage('');
        setShowResult(false);
        setRound(prev => prev + 1);
      };

      // This new function generates a new random headline without changing the round
      const handleRandomHeadline = () => {
        let newIndex;
        // Use a do-while loop to ensure we get a new headline that is not the current one
        do {
          newIndex = Math.floor(Math.random() * gameData.length);
        } while (newIndex === headlineIndex);
        
        setHeadlineIndex(newIndex);
        setUserTranslation('');
        setScore(null);
        setMessage('');
        setShowResult(false);
        // Do not update the round count
      };

      const getEmojiButtonClass = (emoji) => {
        const isCorrect = showResult && correctTranslation.includes(emoji);
        const isUserChoice = showResult && userTranslation.includes(emoji);

        if (showResult) {
          if (isCorrect && isUserChoice) {
            return 'bg-green-400 hover:bg-green-500 shadow-md';
          } else if (isCorrect && !isUserChoice) {
            return 'bg-yellow-400 hover:bg-yellow-500 shadow-md';
          } else if (!isCorrect && isUserChoice) {
            return 'bg-red-400 hover:bg-red-500 shadow-md';
          }
        }
        return 'bg-gray-100 hover:bg-gray-200 shadow-md';
      };

      if (gameStage === GAME_STAGES.SPLASH) {
        return <SplashScreen />;
      }
      if (gameStage === GAME_STAGES.RULES) {
        return <RulesScreen onStartGame={() => setGameStage(GAME_STAGES.GAME)} />;
      }

      return (
        <div className="flex items-center justify-center min-h-screen p-4 font-sans">
          <div className="bg-white rounded-3xl shadow-xl p-6 md:p-10 max-w-lg w-full flex flex-col space-y-6 transform transition-all duration-500">
            <header className="flex justify-between items-center mb-4">
              <h1 className="text-3xl font-bold text-gray-800">Emoji Newsroom</h1>
              <div className="text-lg font-semibold text-gray-600">Round {round}</div>
            </header>

            <div className="bg-gray-100 p-6 rounded-2xl shadow-inner text-center">
              <h2 className="text-xl md:text-2xl font-bold text-gray-900 leading-relaxed">
                {headline}
              </h2>
            </div>

            <div className="relative">
              <input
                type="text"
                readOnly
                value={userTranslation}
                placeholder="Enter your emoji reaction..."
                className={`w-full p-6 text-xl text-center rounded-2xl border-2 border-gray-200 focus:outline-none focus:ring-4 focus:ring-blue-200 transition-all duration-300 shadow-md ${isAnimating ? 'animate-pulse' : ''}`}
                aria-label="Your emoji translation"
              />
              {userTranslation && (
                <button
                  onClick={handleClear}
                  className="absolute right-4 top-1/2 -translate-y-1/2 p-2 rounded-full text-white bg-red-500 hover:bg-red-600 transition-colors duration-200 shadow-md"
                  aria-label="Clear translation"
                >
                  <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path fillRule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clipRule="evenodd" />
                  </svg>
                </button>
              )}
            </div>

            <div className="grid grid-cols-5 md:grid-cols-8 gap-3 mt-6 p-4 bg-gray-50 rounded-2xl shadow-inner">
              {emojiPalette.map((emoji, index) => (
                <button
                  key={index}
                  onClick={() => handleEmojiClick(emoji)}
                  className={`p-2 w-12 h-12 flex items-center justify-center text-2xl rounded-[1.5rem] transition-all duration-300 transform hover:scale-105 active:scale-95 shadow-lg ${getEmojiButtonClass(emoji)}`}
                  aria-label={`Select emoji: ${emoji}`}
                >
                  {emoji}
                </button>
              ))}
            </div>

            {!showResult && (
              <div className="flex flex-col space-y-4 mt-6">
                <button
                  onClick={handleSubmit}
                  className="w-full bg-blue-500 text-white font-bold py-4 px-6 rounded-3xl text-xl transition-all duration-300 hover:bg-blue-600 transform hover:scale-105 active:scale-95 shadow-xl"
                >
                  Submit
                </button>
                <button
                  onClick={handleRandomHeadline}
                  className="w-full bg-gray-400 text-white font-bold py-4 px-6 rounded-3xl text-xl transition-all duration-300 hover:bg-gray-500 transform hover:scale-105 active:scale-95 shadow-xl"
                >
                  RANDOM
                </button>
              </div>
            )}

            {showResult && (
              <div className="mt-6 flex flex-col space-y-4">
                <div className="bg-gray-100 p-4 rounded-3xl text-center shadow-md">
                  <h3 className="text-xl font-bold text-gray-800">Your Score: {score}/10</h3>
                  <p className="text-lg mt-2 text-gray-700">{message}</p>
                </div>
                <div className="bg-gray-100 p-4 rounded-3xl shadow-md">
                  <h3 className="text-lg font-bold text-gray-800">Correct Translation:</h3>
                  <p className="text-3xl text-center mt-2">{correctTranslation}</p>
                </div>
                <div className="bg-gray-100 p-4 rounded-3xl shadow-md">
                  <h3 className="text-lg font-bold text-gray-800">Explanation:</h3>
                  <p className="text-base text-gray-700 mt-2">{explanation}</p>
                </div>
                <button
                  onClick={handleNextRound}
                  className="w-full bg-blue-500 text-white font-bold py-4 px-6 rounded-3xl text-xl mt-4 transition-all duration-300 hover:bg-blue-600 transform hover:scale-105 active:scale-95 shadow-xl"
                >
                  Next Round
                </button>
              </div>
            )}
          </div>
        </div>
      );
    };

    const root = createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
