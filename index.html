<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Emoji Newsroom</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/confetti-js@0.0.18/dist/index.min.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
    body {
      font-family: 'Inter', sans-serif;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-gray-100 to-gray-200 p-4 min-h-screen flex items-center justify-center">

  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;
    const { createRoot } = ReactDOM;

    const gameData = [
      {
        headline: 'Major earthquake shakes the Pacific coast, triggering tsunami warnings.',
        correctTranslation: '🌊⚡️🚨🚸',
        emojiPalette: ['🌊', '⚡️', '🚨', '🚸', '⚠️', '🏠', '💔', '😔', '🗺️'],
        explanation: 'The translation uses a wave (🌊) for the tsunami, a lightning bolt (⚡️) for the earthquake, a siren (🚨) for the warning, and a warning sign (🚸) for the alert.'
      },
      {
        headline: 'Giant panda cub born at the zoo, the first in over a decade.',
        correctTranslation: '🐼👶🎉🆕📅',
        emojiPalette: ['🐼', '👶', '🎉', '🆕', '🔟', '📅', '🐾', '🥳', '🎈'],
        explanation: 'This translation highlights the panda (🐼), the cub (👶), the celebration (🎉), its newness (🆕), and the time frame (📅).'
      },
      {
        headline: 'Record-breaking heatwave sweeps across the globe, causing power outages.',
        correctTranslation: '📈🔥☀️🌍🔌',
        emojiPalette: ['📈', '🔥', '☀️', '🌡️', '🥵', '🌍', '⚡️', '🔌', '📉'],
        explanation: 'The translation uses a chart (📈) for the record, fire (🔥) and sun (☀️) for the heatwave, the globe (🌍) for the location, and a plug (🔌) for the power outages.'
      },
      {
        headline: 'Major technology company announces a breakthrough in quantum computing.',
        correctTranslation: '💻🤯🚀✨',
        emojiPalette: ['💻', '🤯', '🚀', '✨', '🔬', '💡', '🤖', '💰', '🧑‍💻'],
        explanation: 'This captures the computer (💻), the mind-blowing nature (🤯), the rocket (🚀) for breakthrough, and the sparkles (✨) for the new technology.'
      },
      {
        headline: 'New study links playing video games to improved problem-solving skills.',
        correctTranslation: '🎮🧠📈💡',
        emojiPalette: ['🎮', '🧠', '💡', '📈', '✅', '❓', '🤔', '🏆', '🤓'],
        explanation: 'This translates the video game (🎮), the brain (🧠) for skills, the chart (📈) for improvement, and a lightbulb (💡) for problem-solving.'
      },
      {
        headline: 'Discovery of a new coral reef ecosystem with vibrant new species.',
        correctTranslation: '🐠🌊🔎🌈🆕',
        emojiPalette: ['🐠', '🌊', '🔎', '🌈', '🆕', '🌿', '🌱', '🪸', '✨'],
        explanation: 'This uses a fish (🐠) and wave (🌊) for the ecosystem, a magnifying glass (🔎) for discovery, a rainbow (🌈) for vibrant, and a new sign (🆕) for the species.'
      }
    ];

    // New game stages to control flow
    const GAME_STAGES = {
      SPLASH: 'splash',
      RULES: 'rules',
      GAME: 'game'
    };

    // Splash screen component
    const SplashScreen = () => (
      <div className="flex items-center justify-center min-h-screen bg-gradient-to-br from-blue-500 to-indigo-600 text-white animate-fade-in">
        <div className="text-center transform transition-all duration-1000 animate-bounce-slow">
          <h1 className="text-6xl font-extrabold mb-4 drop-shadow-md">📰</h1>
          <h2 className="text-4xl font-extrabold tracking-wide text-white">Emoji Newsroom</h2>
        </div>
      </div>
    );

    // Rules screen component
    const RulesScreen = ({ onStartGame }) => (
      <div className="bg-white rounded-3xl shadow-xl p-6 md:p-10 max-w-lg w-full flex flex-col space-y-6 animate-fade-in">
        <h1 className="text-3xl font-extrabold text-gray-900 text-center">How to Play</h1>
        <div className="text-lg text-gray-700 space-y-4">
          <p>Your mission is to translate a news headline into a series of emojis using the palette provided.</p>
          <ul className="list-disc list-inside space-y-2">
            <li>Select the emojis you think best represent the headline.</li>
            <li>Press "Submit" to see your score.</li>
            <li>The closer your translation is to the correct one, the higher your score!</li>
            <li>Press "Next Round" to continue playing.</li>
          </ul>
        </div>
        <button
          onClick={onStartGame}
          className="w-full bg-blue-500 text-white font-bold py-4 px-6 rounded-2xl text-xl mt-6 transition-all duration-300 hover:bg-blue-600 transform hover:scale-105 active:scale-95 shadow-lg"
        >
          START!
        </button>
      </div>
    );

    const App = () => {
      const [headlineIndex, setHeadlineIndex] = useState(0);
      const [userTranslation, setUserTranslation] = useState('');
      const [score, setScore] = useState(null);
      const [message, setMessage] = useState('');
      const [showResult, setShowResult] = useState(false);
      const [round, setRound] = useState(1);
      const [isAnimating, setIsAnimating] = useState(false);
      const [gameStage, setGameStage] = useState(GAME_STAGES.SPLASH);

      // Effect to handle splash screen transition
      useEffect(() => {
        if (gameStage === GAME_STAGES.SPLASH) {
          const timer = setTimeout(() => {
            setGameStage(GAME_STAGES.RULES);
          }, 3000);
          return () => clearTimeout(timer);
        }
      }, [gameStage]);

      // Effect to handle confetti for high scores
      useEffect(() => {
        if (showResult && score >= 8) {
          const confettiSettings = { target: 'root', size: 1.5, rotate: true };
          const confetti = new ConfettiGenerator(confettiSettings);
          confetti.render();

          // Stop confetti after a few seconds
          setTimeout(() => {
            confetti.clear();
          }, 4000);
        }
      }, [showResult, score]);

      const { headline, correctTranslation, emojiPalette, explanation } = gameData[headlineIndex];

      const handleEmojiClick = (emoji) => {
        if (!showResult) {
          setUserTranslation(prev => prev + emoji);
        }
      };

      const handleClear = () => {
        if (!showResult) {
          setUserTranslation('');
        }
      };

      const handleSubmit = () => {
        if (userTranslation.trim() === '') {
          setMessage('Please enter your translation first.');
          return;
        }
        
        setIsAnimating(true);

        let currentScore = 0;
        if (userTranslation === correctTranslation) {
          currentScore = 10;
          setMessage('Perfect! 10/10!');
        } else {
          const correctSet = new Set(correctTranslation.split(''));
          const userSet = new Set(userTranslation.split(''));
          let matchedCount = 0;
          for (const emoji of userSet) {
            if (correctSet.has(emoji)) {
              matchedCount++;
            }
          }
          currentScore = Math.round((matchedCount / correctSet.size) * 10);
          currentScore = Math.min(currentScore, 10);
          setMessage(`Almost! Score: ${currentScore}/10.`);
        }

        setTimeout(() => {
          setScore(currentScore);
          setShowResult(true);
          setIsAnimating(false);
        }, 500);
      };

      const handleNextRound = () => {
        const nextIndex = (headlineIndex + 1) % gameData.length;
        setHeadlineIndex(nextIndex);
        setUserTranslation('');
        setScore(null);
        setMessage('');
        setShowResult(false);
        setRound(prev => prev + 1);
      };

      const getEmojiButtonClass = (emoji) => {
        const isCorrect = showResult && correctTranslation.includes(emoji);
        const isUserChoice = showResult && userTranslation.includes(emoji);

        if (showResult) {
          if (isCorrect && isUserChoice) {
            return 'bg-green-400 hover:bg-green-500 shadow-md';
          } else if (isCorrect && !isUserChoice) {
            return 'bg-yellow-400 hover:bg-yellow-500 shadow-md';
          } else if (!isCorrect && isUserChoice) {
            return 'bg-red-400 hover:bg-red-500 shadow-md';
          }
        }
        return 'bg-gray-100 hover:bg-gray-200 shadow-md';
      };

      if (gameStage === GAME_STAGES.SPLASH) {
        return <SplashScreen />;
      }
      if (gameStage === GAME_STAGES.RULES) {
        return <RulesScreen onStartGame={() => setGameStage(GAME_STAGES.GAME)} />;
      }

      return (
        <div className="flex items-center justify-center min-h-screen p-4 font-sans">
          <div className="bg-white rounded-3xl shadow-xl p-6 md:p-10 max-w-lg w-full flex flex-col space-y-6 transform transition-all duration-500">
            <header className="flex justify-between items-center mb-4">
              <h1 className="text-3xl font-bold text-gray-800">Emoji Newsroom</h1>
              <div className="text-lg font-semibold text-gray-600">Round {round}</div>
            </header>

            <div className="bg-gray-100 p-6 rounded-2xl shadow-inner text-center">
              <h2 className="text-xl md:text-2xl font-bold text-gray-900 leading-relaxed">
                {headline}
              </h2>
            </div>

            <div className="relative">
              <input
                type="text"
                readOnly
                value={userTranslation}
                placeholder="Enter your emoji reaction..."
                className={`w-full p-6 text-xl text-center rounded-2xl border-2 border-gray-200 focus:outline-none focus:ring-4 focus:ring-blue-200 transition-all duration-300 shadow-md ${isAnimating ? 'animate-pulse' : ''}`}
                aria-label="Your emoji translation"
              />
              {userTranslation && (
                <button
                  onClick={handleClear}
                  className="absolute right-4 top-1/2 -translate-y-1/2 p-2 rounded-full text-white bg-red-500 hover:bg-red-600 transition-colors duration-200 shadow-md"
                  aria-label="Clear translation"
                >
                  <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path fillRule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clipRule="evenodd" />
                  </svg>
                </button>
              )}
            </div>

            <div className="grid grid-cols-5 md:grid-cols-8 gap-3 mt-6 p-4 bg-gray-50 rounded-2xl shadow-inner">
              {emojiPalette.map((emoji, index) => (
                <button
                  key={index}
                  onClick={() => handleEmojiClick(emoji)}
                  className={`p-2 w-12 h-12 flex items-center justify-center text-2xl rounded-[1.5rem] transition-all duration-300 transform hover:scale-105 active:scale-95 shadow-lg ${getEmojiButtonClass(emoji)}`}
                  aria-label={`Select emoji: ${emoji}`}
                >
                  {emoji}
                </button>
              ))}
            </div>

            {!showResult && (
              <button
                onClick={handleSubmit}
                className="w-full bg-blue-500 text-white font-bold py-4 px-6 rounded-3xl text-xl mt-6 transition-all duration-300 hover:bg-blue-600 transform hover:scale-105 active:scale-95 shadow-xl"
              >
                Submit
              </button>
            )}

            {showResult && (
              <div className="mt-6 flex flex-col space-y-4">
                <div className="bg-gray-100 p-4 rounded-3xl text-center shadow-md">
                  <h3 className="text-xl font-bold text-gray-800">Your Score: {score}/10</h3>
                  <p className="text-lg mt-2 text-gray-700">{message}</p>
                </div>
                <div className="bg-gray-100 p-4 rounded-3xl shadow-md">
                  <h3 className="text-lg font-bold text-gray-800">Correct Translation:</h3>
                  <p className="text-3xl text-center mt-2">{correctTranslation}</p>
                </div>
                <div className="bg-gray-100 p-4 rounded-3xl shadow-md">
                  <h3 className="text-lg font-bold text-gray-800">Explanation:</h3>
                  <p className="text-base text-gray-700 mt-2">{explanation}</p>
                </div>
                <button
                  onClick={handleNextRound}
                  className="w-full bg-blue-500 text-white font-bold py-4 px-6 rounded-3xl text-xl mt-4 transition-all duration-300 hover:bg-blue-600 transform hover:scale-105 active:scale-95 shadow-xl"
                >
                  Next Round
                </button>
              </div>
            )}
          </div>
        </div>
      );
    };

    const root = createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
